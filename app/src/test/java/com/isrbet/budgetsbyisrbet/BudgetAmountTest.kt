package com.isrbet.budgetsbyisrbet

import org.junit.Assert
import org.junit.Test

class GetBudgetAmountTest {
    @Test
    fun budgetAmountTest() {
        val spenderModel = SpenderViewModel()
        spenderModel.clearCallback()
        val catModel = CategoryViewModel()
        catModel.clearCallback()
        val budgetModel = BudgetViewModel()
        budgetModel.clearCallback()
        val expModel = ExpenditureViewModel()
        expModel.clearCallback()
        SpenderViewModel.addLocalSpender(Spender("Alex", "alexreid2070@gmail.com", 50, 1))
        SpenderViewModel.addLocalSpender(Spender("Brent", "alexreid2071@gmail.com", 50, 1))
        SpenderViewModel.addLocalSpender(Spender("Joint", "", 100, 1))
        CategoryViewModel.updateCategory(0, "Housing", "Mortgage", cDiscTypeNondiscretionary, true)
        CategoryViewModel.updateCategory(0, "Housing", "Property Taxes", cDiscTypeNondiscretionary, true)
        CategoryViewModel.updateCategory(0, "Housing", "Renos", cDiscTypeNondiscretionary, true)
        CategoryViewModel.updateCategory(0, "Life", "Booze", cDiscTypeDiscretionary, true)
        CategoryViewModel.updateCategory(0, "Life", "Annual", cDiscTypeDiscretionary, true)
        BudgetViewModel.updateBudget(1004, "2022-01", 0, 5.0, cBUDGET_RECURRING, true)
        BudgetViewModel.updateBudget(1005, "2022-00", 0, 10.0, cBUDGET_RECURRING, true)
        BudgetViewModel.updateBudget(1005, "2022-00", 1, 10.0, cBUDGET_RECURRING, true)
        BudgetViewModel.updateBudget(1001, "2022-01", 2, 100.0, cBUDGET_RECURRING, true)
        BudgetViewModel.updateBudget(1003, "2022-00", 2, 12000.0, cBUDGET_JUST_THIS_MONTH, true)
        ExpenditureViewModel.addTransaction(ExpenditureOut("2022-02-15", 4*100, 1004, "test", 0, 0, 100, ""), true)
        ExpenditureViewModel.addTransaction(ExpenditureOut("2022-01-15", 1*100, 1005, "test", 1, 1, 0, ""), true)
        ExpenditureViewModel.addTransaction(ExpenditureOut("2022-01-15", 2*100, 1005, "test", 0, 0, 100, ""), true)
        ExpenditureViewModel.addTransaction(ExpenditureOut("2022-02-15", 4*100, 1005, "test", 0, 0, 100, ""), true)
        ExpenditureViewModel.addTransaction(ExpenditureOut("2022-03-15", 7*100, 1005, "test", 0, 0, 100, ""), true)
        ExpenditureViewModel.addTransaction(ExpenditureOut("2022-04-15", 4*100, 1005, "test", 0, 0, 100, ""), true)
        ExpenditureViewModel.addTransaction(ExpenditureOut("2022-02-15", 100*100, 1003, "test", 2, 2, 50, ""), true)
        ExpenditureViewModel.addTransaction(ExpenditureOut("2022-03-15", 100*100, 1003, "test", 2, 2, 20, ""), true)

        var ac = ExpenditureViewModel.getActualsForPeriod(1004, BudgetMonth(2022,1), BudgetMonth(2022,1), 0)
        Assert.assertEquals(0.0, ac, 0.0)
        ac = ExpenditureViewModel.getActualsForPeriod(1004, BudgetMonth(2022,1), BudgetMonth(2022,1), 1)
        Assert.assertEquals(0.0, ac, 0.0)
        ac = ExpenditureViewModel.getActualsForPeriod(1004, BudgetMonth(2022,1), BudgetMonth(2022,1), 2)
        Assert.assertEquals(0.0, ac, 0.0)
        ac = ExpenditureViewModel.getActualsForPeriod(1004, BudgetMonth(2022,1), BudgetMonth(2022,2), 0)
        Assert.assertEquals(4.0, ac, 0.0)
        ac = ExpenditureViewModel.getActualsForPeriod(1004, BudgetMonth(2022,1), BudgetMonth(2022,2), 1)
        Assert.assertEquals(0.0, ac, 0.0)
        ac = ExpenditureViewModel.getActualsForPeriod(1004, BudgetMonth(2022,1), BudgetMonth(2022,2), 2)
        Assert.assertEquals(0.0, ac, 0.0)
        ac = ExpenditureViewModel.getActualsForPeriod(1005, BudgetMonth(2022,1), BudgetMonth(2022,1), 0)
        Assert.assertEquals(2.0, ac, 0.0)
        ac = ExpenditureViewModel.getActualsForPeriod(1005, BudgetMonth(2022,1), BudgetMonth(2022,1), 1)
        Assert.assertEquals(1.0, ac, 0.0)
        ac = ExpenditureViewModel.getActualsForPeriod(1005, BudgetMonth(2022,1), BudgetMonth(2022,1), 2)
        Assert.assertEquals(0.0, ac, 0.0)
        ac = ExpenditureViewModel.getActualsForPeriod(1005, BudgetMonth(2022,2), BudgetMonth(2022,2), 0)
        Assert.assertEquals(4.0, ac, 0.0)
        ac = ExpenditureViewModel.getActualsForPeriod(1005, BudgetMonth(2022,2), BudgetMonth(2022,2), 1)
        Assert.assertEquals(0.0, ac, 0.0)
        ac = ExpenditureViewModel.getActualsForPeriod(1005, BudgetMonth(2022,2), BudgetMonth(2022,2), 2)
        Assert.assertEquals(0.0, ac, 0.0)
        ac = ExpenditureViewModel.getActualsForPeriod(1005, BudgetMonth(2022,3), BudgetMonth(2022,3), 0)
        Assert.assertEquals(7.0, ac, 0.0)
        ac = ExpenditureViewModel.getActualsForPeriod(1005, BudgetMonth(2022,3), BudgetMonth(2022,3), 1)
        Assert.assertEquals(0.0, ac, 0.0)
        ac = ExpenditureViewModel.getActualsForPeriod(1005, BudgetMonth(2022,3), BudgetMonth(2022,3), 2)
        Assert.assertEquals(0.0, ac, 0.0)
        ac = ExpenditureViewModel.getActualsForPeriod(1005, BudgetMonth(2022,4), BudgetMonth(2022,4), 0)
        Assert.assertEquals(4.0, ac, 0.0)
        ac = ExpenditureViewModel.getActualsForPeriod(1005, BudgetMonth(2022,4), BudgetMonth(2022,4), 1)
        Assert.assertEquals(0.0, ac, 0.0)
        ac = ExpenditureViewModel.getActualsForPeriod(1005, BudgetMonth(2022,4), BudgetMonth(2022,4), 2)
        Assert.assertEquals(0.0, ac, 0.0)
        ac = ExpenditureViewModel.getActualsForPeriod(1005, BudgetMonth(2022,2), BudgetMonth(2022,3), 0)
        Assert.assertEquals(11.0, ac, 0.0)
        ac = ExpenditureViewModel.getActualsForPeriod(1005, BudgetMonth(2022,2), BudgetMonth(2022,3), 1)
        Assert.assertEquals(0.0, ac, 0.0)
        ac = ExpenditureViewModel.getActualsForPeriod(1005, BudgetMonth(2022,2), BudgetMonth(2022,3), 2)
        Assert.assertEquals(0.0, ac, 0.0)

        var bm = BudgetViewModel.getOriginalBudgetAmount(1005, BudgetMonth("2020-01"), 0)
        Assert.assertEquals(0.0, bm.amount, 0.0)
        var bmr = BudgetViewModel.getCalculatedBudgetAmount(BudgetMonth(2020,1), 1005, 0)
        Assert.assertEquals(0.0, bmr, 0.0)

        bm = BudgetViewModel.getOriginalBudgetAmount(1005, BudgetMonth("2022-01"), 0)
        Assert.assertEquals(10.0, bm.amount, 0.0)
        Assert.assertEquals(0, bm.dateStarted.month)
        Assert.assertEquals(1, bm.dateApplicable.month)
        bmr = BudgetViewModel.getCalculatedBudgetAmount(BudgetMonth(2022,1), 1005, 0)
        Assert.assertEquals(2.0, bmr, 0.0)

        bm = BudgetViewModel.getOriginalBudgetAmount(1005, BudgetMonth("2022-02"), 0)
        Assert.assertEquals(10.0, bm.amount, 0.0)
        Assert.assertEquals(0, bm.dateStarted.month)
        Assert.assertEquals(1, bm.dateApplicable.month)
        bmr = BudgetViewModel.getCalculatedBudgetAmount(BudgetMonth(2022,2), 1005, 0)
        Assert.assertEquals(4.0, bmr, 0.0)

        bm = BudgetViewModel.getOriginalBudgetAmount(1005, BudgetMonth("2022-03"), 0)
        Assert.assertEquals(10.0, bm.amount, 0.0)
        Assert.assertEquals(0, bm.dateStarted.month)
        Assert.assertEquals(1, bm.dateApplicable.month)
        bmr = BudgetViewModel.getCalculatedBudgetAmount(BudgetMonth(2022,3), 1005, 0)
        Assert.assertEquals(4.0, bmr, 0.0)

        bm = BudgetViewModel.getOriginalBudgetAmount(1005, BudgetMonth("2022-04"), 0)
        Assert.assertEquals(10.0, bm.amount, 0.0)
        Assert.assertEquals(0, bm.dateStarted.month)
        Assert.assertEquals(1, bm.dateApplicable.month)
        bmr = BudgetViewModel.getCalculatedBudgetAmount(BudgetMonth(2022,4), 1005, 0)
        Assert.assertEquals(0.0, bmr, 0.0)

        bm = BudgetViewModel.getOriginalBudgetAmount(1005, BudgetMonth("2022-01"), 1)
        Assert.assertEquals(10.0, bm.amount, 0.0)
        bmr = BudgetViewModel.getCalculatedBudgetAmount(BudgetMonth("2022-01"), 1005, 1)
        Assert.assertEquals(1.0, bmr, 0.0)

        bm = BudgetViewModel.getOriginalBudgetAmount(1005, BudgetMonth("2022-01"), 2)
        Assert.assertEquals(0.0, bm.amount, 0.0)
        bmr = BudgetViewModel.getCalculatedBudgetAmount(BudgetMonth("2022-01"), 1005, 2)
        Assert.assertEquals(0.0, bmr, 0.0)

        bm = BudgetViewModel.getOriginalBudgetAmount(1004, BudgetMonth("2022-01"), 0)
        Assert.assertEquals(5.0, bm.amount, 0.0)
        var bm2 = BudgetViewModel.budgetExistsForExactPeriod(1004, BudgetMonth("2022-01"), 0)
        Assert.assertEquals(5.0, bm2, 0.0)

        bm = BudgetViewModel.getOriginalBudgetAmount(1004, BudgetMonth("2022-01"), 2)
        Assert.assertEquals(0.0, bm.amount, 0.0)
        bmr = BudgetViewModel.getCalculatedBudgetAmount(BudgetMonth("2022-01"), 1004, 2)
        Assert.assertEquals(0.0, bmr, 0.0)

        bm = BudgetViewModel.getOriginalBudgetAmount(1004, BudgetMonth("2022-01"), 1)
        Assert.assertEquals(0.0, bm.amount, 0.0)
        bm2 = BudgetViewModel.budgetExistsForExactPeriod(1004, BudgetMonth("2022-01"), 1)
        Assert.assertEquals(0.0, bm2, 0.0)
        bmr = BudgetViewModel.getCalculatedBudgetAmount(BudgetMonth("2022-01"), 1004, 1)
        Assert.assertEquals(0.0, bmr, 0.0)

        bm2 = BudgetViewModel.budgetExistsForExactPeriod(1004, BudgetMonth("2022-01"), 0)
        Assert.assertEquals(5.0, bm2, 0.0)

        var totBu = BudgetViewModel.getTotalCalculatedBudgetForMonth(BudgetMonth(2022,1),cDiscTypeDiscretionary)
        var totAc = ExpenditureViewModel.getTotalDiscretionaryActualsToDate(BudgetMonth(2022,1))
        Assert.assertEquals(3.0, totAc, 0.0)
        Assert.assertEquals(8.0, totBu, 0.0)

        totBu = BudgetViewModel.getTotalCalculatedBudgetForMonth(BudgetMonth(2022,2),cDiscTypeDiscretionary)
        totAc = ExpenditureViewModel.getTotalDiscretionaryActualsToDate(BudgetMonth(2022,2))
        Assert.assertEquals(8.0, totAc, 0.0)
        Assert.assertEquals(9.0, totBu, 0.0)

        bm = BudgetViewModel.getOriginalBudgetAmount(1001, BudgetMonth("2022-01"), 0)
        Assert.assertEquals(0.0, bm.amount, 0.0)
        bm2 = BudgetViewModel.budgetExistsForExactPeriod(1001, BudgetMonth("2022-01"), 0)
        Assert.assertEquals(0.0, bm2, 0.0)
        bmr = BudgetViewModel.getCalculatedBudgetAmount(BudgetMonth("2022-01"), 1001, 0)
        Assert.assertEquals(50.0, bmr, 0.0)
        bm = BudgetViewModel.getOriginalBudgetAmount(1001, BudgetMonth("2022-01"), 1)
        Assert.assertEquals(0.0, bm.amount, 0.0)
        bm2 = BudgetViewModel.budgetExistsForExactPeriod(1001, BudgetMonth("2022-01"), 1)
        Assert.assertEquals(0.0, bm2, 0.0)
        bmr = BudgetViewModel.getCalculatedBudgetAmount(BudgetMonth("2022-01"), 1001, 1)
        Assert.assertEquals(50.0, bmr, 0.0)
        bm = BudgetViewModel.getOriginalBudgetAmount(1001, BudgetMonth("2022-01"), 2)
        Assert.assertEquals(100.0, bm.amount, 0.0)
        bm2 = BudgetViewModel.budgetExistsForExactPeriod(1001, BudgetMonth("2022-01"), 2)
        Assert.assertEquals(100.0, bm2, 0.0)
        bmr = BudgetViewModel.getCalculatedBudgetAmount(BudgetMonth("2022-01"), 1001, 2)
        Assert.assertEquals(100.0, bmr, 0.0)

        bm = BudgetViewModel.getOriginalBudgetAmount(1001, BudgetMonth("2022-02"), 0)
        Assert.assertEquals(0.0, bm.amount, 0.0)
        bm2 = BudgetViewModel.budgetExistsForExactPeriod(1001, BudgetMonth("2022-02"), 0)
        Assert.assertEquals(0.0, bm2, 0.0)
        bmr = BudgetViewModel.getCalculatedBudgetAmount(BudgetMonth("2022-02"), 1001, 0)
        Assert.assertEquals(50.0, bmr, 0.0)
        bm = BudgetViewModel.getOriginalBudgetAmount(1001, BudgetMonth("2022-02"), 1)
        Assert.assertEquals(0.0, bm.amount, 0.0)
        bm2 = BudgetViewModel.budgetExistsForExactPeriod(1001, BudgetMonth("2022-02"), 1)
        Assert.assertEquals(0.0, bm2, 0.0)
        bmr = BudgetViewModel.getCalculatedBudgetAmount(BudgetMonth("2022-02"), 1001, 1)
        Assert.assertEquals(50.0, bmr, 0.0)
        bm = BudgetViewModel.getOriginalBudgetAmount(1001, BudgetMonth("2022-02"), 2)
        Assert.assertEquals(100.0, bm.amount, 0.0)
        bm2 = BudgetViewModel.budgetExistsForExactPeriod(1001, BudgetMonth("2022-02"), 2)
        Assert.assertEquals(0.0, bm2, 0.0)
        bmr = BudgetViewModel.getCalculatedBudgetAmount(BudgetMonth("2022-02"), 1001, 2)
        Assert.assertEquals(100.0, bmr, 0.0)

        bmr = BudgetViewModel.getCalculatedBudgetAmount(BudgetMonth("2022-02"), 1003, 0)
        Assert.assertEquals(50.0, bmr, 0.0)

        bmr = BudgetViewModel.getCalculatedBudgetAmount(BudgetMonth("2022-03"), 1003, 0)
        Assert.assertEquals(20.0, bmr, 0.0)
        bmr = BudgetViewModel.getCalculatedBudgetAmount(BudgetMonth("2022-03"), 1003, 1)
        Assert.assertEquals(80.0, bmr, 0.0)
        bmr = BudgetViewModel.getTotalCalculatedBudgetForMonthForCategory(1003, BudgetMonth("2022-03"), cDiscTypeAll)
        Assert.assertEquals(100.0, bmr, 0.0)
    }
}